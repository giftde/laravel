!function(t){function e(o){if(n[o])return n[o].exports;var s=n[o]={exports:{},id:o,loaded:!1};return t[o].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){n(2),document.querySelectorAll||(document.querySelectorAll=function(t){var e,n=document.createElement("style"),o=[];for(document.documentElement.firstChild.appendChild(n),document._qsa=[],n.styleSheet.cssText=t+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),n.parentNode.removeChild(n);document._qsa.length;)e=document._qsa.shift(),e.style.removeAttribute("x-qsa"),o.push(e);return document._qsa=null,o}),~function(t){var e,n={propertyName:"data-stat-id",urlParam:"stat",needMap:!0,domain:".mi.com",live:!1},o={parentLoop:!1,sonLoop:!1,exposure:null,drawDataScript:"//c1.mifile.cn/f/i/15/stat/js/jquery.dataDraw.min.js",jquerySource:"//s01.mifile.cn/js/lib/jquery.min.js",re:{normalEnd:/\/(index.php|index.html|index.htm|index)$/,snapshotModalDate:/^(\/\d{10}\/)/,snapshotModalEnd:/.html$/},locationObj:{protocol:location.protocol+"//",host:location.host,pathname:location.pathname}},s={isSnapshotModal:function(){return"file.stat.be.xiaomi.com"==location.host?!0:!1},hashSnapshotModal:function(){return o.locationObj.protocol+location.pathname.replace(o.re.snapshotModalDate,"").replace(o.re.snapshotModalEnd,"").replace(o.re.normalEnd,"/")},getPageHash:function(){var t=o.locationObj;t.pathname=t.pathname.replace(o.re.normalEnd,"/");var e=this.isSnapshotModal()?this.hashSnapshotModal():c(t,"");return xmstMd5("undefined"!=typeof _STAT_HASHNAME&&""!=_STAT_HASHNAME?_STAT_HASHNAME:e)},isOpenCanvas:function(){return e.needMap&&r(e.urlParam,"search")&&"true"==r(e.urlParam,"search")?!0:!1},appendStatModal:function(t){var n=xmstTools.trim(t.attr("href"))||"";if(this.isOpenCanvas()&&-1!=n.indexOf("/")&&(-1==n.indexOf("http")||-1!=n.indexOf(e.domain))){var s,i=(e.urlParam+"=true",{hashName:n.split("#"),searchName:n.split("?")});if(this.isSnapshotModal()){var r=i.searchName[0].replace("http://",""),a=location.pathname.replace(o.re.snapshotModalDate,"").replace(o.re.snapshotModalEnd,"");s=location.href.replace(a,r)}else s=i.hashName[1]?i.hashName[0]+"?"+e.urlParam+"=true#"+i.hashName[1]:i.searchName[1]?n+"&"+e.urlParam+"=true":n+"?"+e.urlParam+"=true";t.attr("href",s)}}},i=function(){xmstTools.loadScript(o.drawDataScript,function(e,n,o){t("body").linkSigntoDraw({pageID:s.getPageHash()})})},r=function(t,e){var n="",o=!1,s="hash"==e?location.hash:location.search,i="hash"==e?"#":"?";if(0===s.length)return n;if(0==s.indexOf(i)&&s.indexOf("=")>1)for(var r=s.substring(1,s.length).split("&"),a=0;a<r.length&&!o;)r[a].indexOf("=")>0&&r[a].split("=")[0].toLowerCase()==t.toLowerCase()&&(n=r[a].split("=")[1],o=!0),a++;return n},a=function(n,r,a){var d=t(n).hasClass("J_linksign-customize"),u=d?t(n).children():t(n).find("a"),p={page:s.getPageHash(),point:null},h=u.length-1,m=s.isOpenCanvas();r===a&&(o.parentLoop=!0),u.each(function(n,a){if("true"!=t(a).attr("data-stat-exclude")){var u=xmstTools.trim(t(a).attr("href"))||t(a).attr("data-stat-productid")||"",_=xmstTools.trim(t(a).text()),f=t(a).parent().parent().attr("class")||t(a).parent().parent().parent().attr("class")||"",g=r+""+n,v=t(a).attr("data-stat-aid"),w=t(a).attr("data-stat-pid"),L=t(a).attr("data-log_code")||"";u=-1!==u.indexOf(e.domain)?u.split("?")[0]:u;var y=u+_+f;y=d?y+g:y,p.point=w?v+"+"+w:xmstMd5(y);var x=t(a).attr("onclick")||"",S=l(c(p,"-"),u,L),E=S+x;t(a).attr(e.propertyName)||t(a).attr(e.propertyName,p.point).attr("onclick",E),s.appendStatModal(t(a)),o.parentLoop===!0&&n===h&&m&&(o.sonLoop=!0,i())}})},l=function(t,e,n){var o=xmstTools.stripscript("'trackEvent', '"+t+"', '"+e+"', 'pcpid', '"+n+"'");return"_msq.push(["+o+"]);"},c=function(t,e){var n=[];if("undefined"!=typeof t)for(var o in t){var s=t[o];s=null==s||""==s?"00":s,n.push(s)}return n.join(e)},d=function(){t.fn.linkSign=function(s){e=t.extend(n,s);var i=this.length-1;this.each(function(t,e){a(this,t,i)});var r=o.exposure;r?r.update():r=xmstSp({elements_selector:".exposure"})},t(function(){t("body,.J_linksign-customize").linkSign()})};t?d():/http(s)?:\/\/m\.mi\.com/i.test(location.href)?timer=window.setInterval(function(){Zepto&&(window.clearInterval(timer),d())},500):xmstTools.loadScript("//c1.mifile.cn/f/i/15/stat/js/zepto.1.1.6.js",function(){t=Zepto,d()})}(window.jQuery||window.Zepto)},function(module,exports){xmstSp=function(instanceSettings){function _init(){_isInitialized||(_defaultSettings={elements_selector:"img",container:window,threshold:300,throttle:300,skip_invisible:!0,callback_load:null,callback_error:null,callback_set:null,callback_processed:null},_supportsAddEventListener=!!window.addEventListener,_supportsAttachEvent=!!window.attachEvent,_supportsClassList=!!document.body.classList,_isInitialized=!0)}function _addEventListener(t,e,n){return _supportsAddEventListener?void t.addEventListener(e,n):void(_supportsAttachEvent&&(t.attachEvent("on"+e,function(t){return function(){n.call(t,window.event)}}(t)),t=null))}function _removeEventListener(t,e,n){return _supportsAddEventListener?void t.removeEventListener(e,n):void(_supportsAttachEvent&&t.detachEvent("on"+e,n))}function _isInsideViewport(t,e,n){function o(){return window.innerWidth||u.documentElement.clientWidth||document.body.clientWidth}function s(){return window.innerHeight||u.documentElement.clientHeight||document.body.clientHeight}function i(t){return t.getBoundingClientRect().top+p-u.documentElement.clientTop}function r(t){return t.getBoundingClientRect().left+h-u.documentElement.clientLeft}function a(){var o;return o=e===window?s()+p:i(e)+e.offsetHeight,o<=i(t)-n}function l(){var s;return s=e===window?o()+window.pageXOffset:r(e)+o(),s<=r(t)-n}function c(){var o;return o=e===window?p:i(e),o>=i(t)+n+t.offsetHeight}function d(){var o;return o=e===window?h:r(e),o>=r(t)+n+t.offsetWidth}var u,p,h;return u=t.ownerDocument,p=window.pageYOffset||u.body.scrollTop,h=window.pageXOffset||u.body.scrollLeft,!(a()||c()||l()||d())}function _now(){var t=new Date;return t.getTime()}function _merge_objects(t,e){var n,o={};for(n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);for(n in e)e.hasOwnProperty(n)&&(o[n]=e[n]);return o}function _convertToArray(t){try{return Array.prototype.slice.call(t)}catch(e){var n,o=[],s=t.length;for(n=0;s>n;n++)o.push(t[n]);return o}}function _bind(t,e){return function(){return t.apply(e,arguments)}}function LazyLoad(){_init(),this._settings=_merge_objects(_defaultSettings,instanceSettings),this._queryOriginNode=this._settings.container===window?document:this._settings.container,this._previousLoopTime=0,this._loopTimeout=null,this._handleScrollFn=_bind(this.handleScroll,this),_addEventListener(window,"resize",this._handleScrollFn),this.update()}var _defaultSettings,_supportsAddEventListener,_supportsAttachEvent,_supportsClassList,_isInitialized=!1,vars=[];return LazyLoad.prototype._loopThroughElements=function(){var i,element,settings=this._settings,elements=this._elements,elementsLength=elements?elements.length:0,insideLogs=[],insideLogCodes=[],logValue="",logCodeValue="",processedIndexes=[];for(i=0;elementsLength>i;i++)element=elements[i],settings.skip_invisible&&null===element.offsetParent||_isInsideViewport(element,settings.container,settings.threshold)&&((logValue=element.getAttribute("data-log_code"))&&(insideLogs.push(logValue),(logCodeValue=element.getAttribute("onclick"))&&(logCodeValue=eval(logCodeValue.replace("_msq.push","")),5==logCodeValue.length&&insideLogCodes.push(logCodeValue[1]))),processedIndexes.push(i),element.wasProcessed=!0);for(insideLogs.length&&this._sendData(insideLogCodes.join(";"),encodeURIComponent(insideLogs.join(";")));processedIndexes.length>0;)elements.splice(processedIndexes.pop(),1),settings.callback_processed&&settings.callback_processed(elements.length);0===elementsLength&&this._stopScrollHandler()},LazyLoad.prototype._sendData=function(t,e){vars.pageid=xmstTools.getPcid();var n=xmstTools.getBaseParam(vars),o=xmstTools.getVars(vars),s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src="//a.stat.xiaomi.com/js/mstr.js?"+n+o+"&type=sp&logs="+t+"&log_codes="+e;var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(s,i)},LazyLoad.prototype._purgeElements=function(){var t,e,n=this._elements,o=n.length,s=[];for(t=0;o>t;t++)e=n[t],e.wasProcessed&&s.push(t);for(;s.length>0;)n.splice(s.pop(),1)},LazyLoad.prototype._startScrollHandler=function(){this._isHandlingScroll||(this._isHandlingScroll=!0,_addEventListener(this._settings.container,"scroll",this._handleScrollFn))},LazyLoad.prototype._stopScrollHandler=function(){this._isHandlingScroll&&(this._isHandlingScroll=!1,_removeEventListener(this._settings.container,"scroll",this._handleScrollFn))},LazyLoad.prototype.handleScroll=function(){var t,e,n;this._settings&&(e=_now(),n=this._settings.throttle,0!==n?(t=n-(e-this._previousLoopTime),0>=t||t>n?(this._loopTimeout&&(clearTimeout(this._loopTimeout),this._loopTimeout=null),this._previousLoopTime=e,this._loopThroughElements()):this._loopTimeout||(this._loopTimeout=setTimeout(_bind(function(){this._previousLoopTime=_now(),this._loopTimeout=null,this._loopThroughElements()},this),t))):this._loopThroughElements())},LazyLoad.prototype.update=function(){this._elements=_convertToArray(this._queryOriginNode.querySelectorAll(this._settings.elements_selector)),this._purgeElements(),this._loopThroughElements(),this._startScrollHandler()},LazyLoad.prototype.destroy=function(){_removeEventListener(window,"resize",this._handleScrollFn),this._loopTimeout&&(clearTimeout(this._loopTimeout),this._loopTimeout=null),this._stopScrollHandler(),this._elements=null,this._queryOriginNode=null,this._settings=null},new LazyLoad}}]);